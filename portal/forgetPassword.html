<!DOCTYPE html>
<html>
    <head>
        <meta charset=UTF-8"utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>智朗-教育管理微平台</title>
		<link rel="icon" type="image/x-icon" href="images/favicon.ico"/>
        <meta name="keywords" content="智朗 智朗微信 朗朗 家校沟通 教育微信 教育行业微信 教育微信大管家 校园微网站 校园微信 学校微信公众号">
        <meta name="description" content="智朗 智朗微信 朗朗 家校沟通 教育微信 教育行业微信 教育微信大管家 校园微网站 校园微信 学校微信公众号">
        <link rel="stylesheet" href="../css/calert.css" tppabs="http://www.zhilangedu.cn/css/calert.css" />
        <link rel="stylesheet" href="../css/cui.css" tppabs="http://www.zhilangedu.cn/css/cui.css" />
        <link rel="stylesheet" href="../css/style.css" tppabs="http://www.zhilangedu.cn/css/style.css" />
        <link rel="stylesheet" type="text/css" href="css/normal.css" tppabs="http://www.zhilangedu.cn/portal/css/normal.css" />
		<link rel="stylesheet" type="text/css" href="css/index.css" tppabs="http://www.zhilangedu.cn/portal/css/index.css" />
        <script type="text/javascript" src="../js/jquery.js" tppabs="http://www.zhilangedu.cn/js/jquery.js"></script>
        <script src="../js/common.js" tppabs="http://www.zhilangedu.cn/js/common.js" type="text/javascript"></script> 
        <script src="../bss/js/zhilang-alert.js" tppabs="http://www.zhilangedu.cn/bss/js/zhilang-alert.js" type="text/javascript"></script>
        <script src="../js/placeholder.js" tppabs="http://www.zhilangedu.cn/js/placeholder.js" type="text/javascript"></script>
        <!--[if IE]>
        <script src="js/html5.js" tppabs="http://www.zhilangedu.cn/portal/js/html5.js"></script>
        <script src="js/respond.js" tppabs="http://www.zhilangedu.cn/portal/js/respond.js"></script>
        <![endif]-->
        <script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "../../hm.baidu.com/hm.js-1c4b331f0676795618b622a5eaac989e"/*tpa=http://hm.baidu.com/hm.js?1c4b331f0676795618b622a5eaac989e*/;
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
		</script>
        <style>
        .user-table .input-select{width:104.9px;}
        .user-id>*{vertical-align:middle;}
        .user-id>i{font-style: normal;}
        .user-table tr>td:first-child{padding-right:8px;}
        </style>
        <style>
        .nav{
       		background: white;
    		height: 50px;
        }
        .nav li {
		    width: 105px;
		    border-right: 0px;
		}
		.nav li a {
		    font-weight: normal;
		    background: white;
		    font-family: 'microsoft yahei';
		}
		#fd {
		    color: #fff;
		    font-size: 12px;
		    background: #323232;
		    height: 50px;
		    line-height: 50px;
		    text-align: center;
	        padding-top: 0px;
	        font-family: 'microsoft yahei';
		}
        </style>
    </head>
    <body>
        <!-- 头部 -->
        <div id="header">
           
        </div>
        <!--内容部分-->
        <div id="bd">
          <div class="wp">
            <div class="box-user">
                <div class="col-l"> 
                    <div class="tit-a1">
                        <strong>找回密码</strong>
                    </div>             

                    <div class="user-table" id="baseInfo">
                          <form action="">   
                          <table>
                             <tr>
                                 <!-- <td><span>手机号码：</span></td> -->
                                 <td>手机号</td>
                                 <td><input type="text" name="" id="callNum" class="txt" placeholder="请输入手机号码"/><em>*</em></td>
                             </tr>
                             <tr>
                                 <!-- <td><span>短信验证码：</span></td> -->
                             	 <td>手机验证码</td>
                                 <td><input type="text" name="" id="textcode" class="txt txt2" placeholder="请输入手机验证码"/>
                                 <a href="javascript:sendCode();" class="sub">获取验证码</a>
                                 <input type="hidden" id="savecode" />
                                 <span id="Second" style="display: none;" class="get_sms">验证码60秒后失效！</span></td>
                                 
                             </tr>
                             <tr>
                                 <!-- <td><span>设置密码：</span></td> -->
                             	 <td>密码</td>
                                 <td><input type="password" name="" id="pass" class="txt"  placeholder="请输入密码"/><em>*</em></td>
                             </tr>
                             <tr>
                                 <!-- <td><span>确认密码：</span></td> -->
                             	 <td>确认密码</td>
                                 <td><input type="password" name="" id="reportpass" class="txt" placeholder="请再次输入密码"/><em>*</em></td>
                             </tr>
                             <tr>
                                 <td><span></span></td>
                                 <td><a href="javascript:reSetPassword();" class="sub2">确认</a></td>
                             </tr>
                         </table>
                          </form>
                    </div>
                    
                  </div>  
                  <div class="col-r">
                      <div class="pic">
                          <p>智朗教育管理微平台</p>
                      </div>
                  </div>
             </div>
          </div> 
        </div>
        <!-- 底部 -->
        <div class="h"></div>
        <div id="fd">
        </div>
        <div id="updateTip"></div>
        
     <script type="text/javascript">
	   var cTime;
	
	  
	$(function() {
		var n = $('#callNum');
        n.focus(function(){
            $(this).val('');
        }).blur(function(){
        	if(null == $("#callNum").val() || "" == $("#callNum").val())
        	{
        		/* $(this).val('请输入手机号'); */
        		$(this).val();
        	}
        });
	});
	
	/**
	*	发送验证码。
	*/
	function sendCode()
	{
		
		//不可重复发送验证码
		if(cTime && cTime > 0){
			$("#errmsg").calert('alert',"验证码已发送!");
		}
		// 验证手机号
		var callNum = $("#callNum").val();
		var re = /^1\d{10}$/
	    if (re.test(callNum))
	    {
	    	
	    } else {
	    	$("#errmsg").calert('alert',"请输入正确格式的手机号码!");
	        return;
	    }
		
		 var url  =  "/user/op/sendCodeForPassword.shtml?callNum=" + callNum;
		 $.ajax({
			 url:url,
			 type:"post",
			 data:{},
			 dataType:"text",
			 async: false,
			 success:function(responseText) {
				 if("unUsed" == responseText) {
					 $("#errmsg").calert('alert',"该手机号还没注册，请注册!");
					 return;
				 }
				 var code = responseText.split(",")[1];
				 if("success" == responseText.split(",")[0]) {
					 $("#sendCode").html("再次获取");
					 $("#savecode").attr("value",code);
					 $("#sendCode").css("display","none");
					 $("#Second").css("display","block");
					 cTime = 120;
					 TimeClose();
				 }else{
					 $("#errmsg").calert('alert',"提交失败!");
				 }
			 }
		 });
	}
	
	function TimeClose(){
		if(cTime==0){
			 $("#sendCode").css("display","block");
			 $("#Second").css("display","none");
		}else{
			window.setTimeout('TimeClose()',1000);//让程序每秒重复执行当前函数。
			this.Second.innerHTML=" 验证码 "+cTime+"s后失效!";
			cTime--;
		}
	}
	//修改tip
	function updateTip() {
		var options = {
			content : '修改成功,是否立刻前往登录?',
			onOk : function() {
				window.location.href = "http://www.zhilangedu.cn/html/login.html";
			}
		};
		$('#updateTip').calert(options).calert("show");
	}
	/**
	*找回密码
	*/
	function reSetPassword()
	{
		
		//发送的验证码
		var savecode = $("#savecode").val();
		//输入的验证码
		var textcode = $("#textcode").val();
		//密码
		var pass = $("#pass").val();
		//确认密码
		var reportpass = $("#reportpass").val();
		//手机号
		var callNum = $("#callNum").val();
		
		var reg = /^[\w]{6,12}$/
		
		if(null == savecode || "" == savecode)
		{
			$("#errmsg").calert('alert',"请先获取验证码!");
			return;
		}
		else if(1 > cTime || savecode != textcode)
		{
			$("#errmsg").calert('alert',"验证码无效，请重新填写!");
			return;
		}
		else if(null == pass || "" == pass)
		{
			$("#errmsg").calert('alert',"请先填写密码!");
			return;
		}
		else if(null == reportpass || "" == reportpass)
		{
			$("#errmsg").calert('alert',"请重复填写密码!");
			return;
		}
		
		else if (!reg.test(pass))
	    {
			$("#errmsg").calert('alert',"密码为6-12位!");
	        return;
	    }
		else if(pass != reportpass)
		{
			$("#errmsg").calert('alert',"两次密码填写不同，请重新填写!");
			return;
		}
		var url = "/user/op/reSetPassword.shtml";
		var params = {};
		params.cellphone = callNum;
		params.password = pass;
		$.post(url, params,
                function (data) {
                    if (data.errorCode==0) {
                    	updateTip();
                    } else {
                    	$("#errmsg").calert('alert',data.errorMessage);
                    }
        },"json"); 
		
	}
	</script>
	<div id="errmsg"></div>
    </body>
</html>